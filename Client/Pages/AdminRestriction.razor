@using Blazored.LocalStorage
@inject NavigationManager Navigation
@inject ILocalStorageService localStore
@inject HttpClient Http

@code {

    protected override async Task OnInitializedAsync()
    {
        await CheckCredentials();
        
    }
    
    public async Task CheckCredentials()
    {
        var localStorageUser = await localStore.GetItemAsync<Administrator>("currentAdministrator");
    
        if (localStorageUser == null)
        {
            var currentUrl = Navigation.Uri;
            await localStore.SetItemAsync("target", currentUrl);
            Navigation.NavigateTo("/login");
        }
        else
        {
            var email = localStorageUser.Email;
            var user = await Http.GetFromJsonAsync<Administrator>("https://localhost:7026/api/admin/get-by-email/" + email);

            if (user.Role != "Administrator")
            {
                Navigation.NavigateTo("/ingenadgang");
            }
        }
    }
}